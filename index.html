<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªùi Kh√≥a Bi·ªÉu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --text-primary: #1a202c;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            --accent: #6366f1;
            --accent-light: #818cf8;
            --danger: #ef4444;
            --success: #10b981;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.18);
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-gradient: linear-gradient(135deg, #4338ca 0%, #7c3aed 100%);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.3), 0 2px 4px -1px rgba(0,0,0,0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.3), 0 4px 6px -2px rgba(0,0,0,0.2);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.3), 0 10px 10px -5px rgba(0,0,0,0.2);
            --glass-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(148, 163, 184, 0.18);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Glassmorphism effect */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
        }

        /* Header */
        header {
            background: var(--bg-primary);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            background: var(--bg-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* Navigation */
        nav {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .nav-tabs {
            display: flex;
            gap: 0;
            min-width: min-content;
        }

        .nav-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            white-space: nowrap;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .nav-tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--accent);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-icon {
            padding: 10px;
            border-radius: 12px;
            background: var(--bg-secondary);
            border: none;
            color: var(--text-primary);
            font-size: 18px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-icon:hover {
            transform: scale(1.1) rotate(5deg);
            background: var(--accent);
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }

        /* Week Navigation */
        .week-nav {
            background: var(--bg-primary);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            border-radius: 16px;
            margin: 16px 0;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .week-nav::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--bg-gradient);
        }

        .week-info {
            flex: 1;
            text-align: center;
        }

        .week-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
            background: var(--bg-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .week-date {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Schedule Grid */
        .schedule-grid {
            background: var(--bg-primary);
            border-radius: 16px;
            overflow-x: auto;
            overflow-y: hidden;
            box-shadow: var(--shadow-lg);
            margin-bottom: 20px;
            position: relative;
            -webkit-overflow-scrolling: touch;
        }

        .schedule-grid::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--bg-gradient);
            z-index: 1;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 60px repeat(6, 1fr);
            min-width: 700px;
            padding-bottom: 16px;
        }

        .grid-header {
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            z-index: 10;
            font-weight: 700;
            font-size: 14px;
            padding: 16px 8px;
            text-align: center;
            border-bottom: 2px solid var(--border-color);
            transition: all 0.3s;
        }

        .grid-header.today {
            background: var(--bg-gradient);
            color: white;
            font-size: 15px;
        }

        .grid-time {
            background: var(--bg-secondary);
            padding: 12px 8px;
            text-align: center;
            font-size: 12px;
            font-weight: 700;
            border-right: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
            line-height: 1.3;
        }

        .time-label {
            display: block;
            font-size: 11px;
            opacity: 0.8;
            margin-top: 2px;
        }

        .grid-cell {
            padding: 6px;
            border-right: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            min-height: 90px;
            position: relative;
            transition: background 0.3s;
        }

        .grid-cell:hover {
            background: var(--bg-secondary);
        }

        .subject-card {
            background: linear-gradient(135deg, var(--subject-color) 0%, var(--subject-color-light) 100%);
            border-radius: 12px;
            padding: 12px;
            height: 100%;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .subject-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .subject-card:hover::before {
            opacity: 1;
        }

        .subject-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        .subject-card:active {
            transform: translateY(-2px) scale(1.01);
        }

        .subject-name {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
            color: #fff;
            position: relative;
            z-index: 1;
        }

        .subject-info {
            font-size: 11px;
            opacity: 0.95;
            color: #fff;
            position: relative;
            z-index: 1;
        }

        /* Today View */
        .today-container {
            padding: 16px 0 120px 0;
        }

        .today-card {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .today-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--bg-gradient);
            transform: scaleY(0);
            transition: transform 0.3s;
        }

        .today-card:hover::before {
            transform: scaleY(1);
        }

        .today-card:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-xl);
        }

        .today-card.current {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
        }

        .today-card.current .today-time,
        .today-card.current .today-details {
            color: rgba(255, 255, 255, 0.9);
        }

        .today-time {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .today-subject {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .today-details {
            display: flex;
            gap: 12px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .countdown {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            display: inline-block;
            margin-top: 12px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 16px;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 24px;
            padding: 32px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--bg-gradient);
            border-radius: 24px 24px 0 0;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 800;
            background: var(--bg-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 14px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            transform: translateY(-2px);
        }

        .color-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .color-option {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 12px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .color-option::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .color-option.selected {
            border-color: var(--text-primary);
            transform: scale(1.15);
            box-shadow: var(--shadow-lg);
        }

        .color-option.selected::after {
            transform: translate(-50%, -50%) scale(1);
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            padding: 12px 0 max(12px, env(safe-area-inset-bottom));
            box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .bottom-nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 32px;
            height: 3px;
            background: var(--bg-gradient);
            border-radius: 0 0 3px 3px;
            transition: transform 0.3s;
        }

        .bottom-nav-item.active::before {
            transform: translateX(-50%) scaleX(1);
        }

        .bottom-nav-item.active {
            color: var(--accent);
        }

        .bottom-nav-item:hover {
            background: var(--bg-secondary);
            transform: translateY(-2px);
        }

        .bottom-nav-icon {
            font-size: 24px;
            transition: transform 0.3s;
        }

        .bottom-nav-item.active .bottom-nav-icon {
            transform: scale(1.2);
        }

        /* Hide/Show Views */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 16px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Activities List */
        .activities-list {
            /* Removed padding - now using inline style */
        }

        .activity-item {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .activity-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            transform: scaleY(0);
            transition: transform 0.3s;
        }

        .activity-item:hover::before {
            transform: scaleY(1);
        }

        .activity-item:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-xl);
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .activity-name {
            font-weight: 700;
            font-size: 18px;
            flex: 1;
        }

        .activity-time {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
            background: var(--bg-secondary);
            padding: 4px 12px;
            border-radius: 8px;
        }

        .activity-details {
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .activity-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .subject-item {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .subject-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--bg-gradient);
            transform: scaleY(0);
            transition: transform 0.3s;
        }

        .subject-item:hover::before {
            transform: scaleY(1);
        }

        .subject-item:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-xl);
        }

        .subject-color-badge {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: transform 0.3s;
        }

        .subject-item:hover .subject-color-badge {
            transform: scale(1.1) rotate(5deg);
        }

        .subject-item-info {
            flex: 1;
        }

        .subject-item-name {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .subject-item-details {
            font-size: 14px;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .grid-container {
                grid-template-columns: 50px repeat(6, minmax(90px, 1fr));
                min-width: 650px;
            }

            .logo {
                font-size: 18px;
            }
            
            .week-nav {
                padding: 16px;
            }
            
            .week-title {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">Th·ªùi kh√≥a bi·ªÉu</div>
            <div class="header-actions">
                <button class="btn-icon" onclick="toggleTheme()" title="Chuy·ªÉn theme">üåô</button>
                <button class="btn-icon" onclick="showSettings()" title="C√†i ƒë·∫∑t">‚öôÔ∏è</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Week View -->
        <div id="weekView" class="view active">
            <div class="week-nav">
                <button class="btn-icon" onclick="previousWeek()">‚Üê</button>
                <div class="week-info">
                    <div class="week-title" id="weekTitle">Tu·∫ßn hi·ªán t·∫°i</div>
                    <div class="week-date" id="weekDate"></div>
                </div>
                <button class="btn-icon" onclick="nextWeek()">‚Üí</button>
                <button class="btn btn-small" onclick="goToToday()">H√¥m nay</button>
            </div>

            <div style="display: flex; gap: 8px; margin-bottom: 16px; align-items: center;">
                <button class="btn btn-small" onclick="showAddScheduleQuick()">‚ûï Th√™m ti·∫øt</button>
                <div style="display: flex; gap: 8px; flex: 1;">
                    <button class="btn" id="btnMorning" onclick="showSession('morning')" style="flex: 1;">‚òÄÔ∏è S√°ng</button>
                    <button class="btn" id="btnAfternoon" onclick="showSession('afternoon')" style="flex: 1; background: var(--text-secondary);">üåô Chi·ªÅu</button>
                </div>
            </div>

            <div class="schedule-grid">
                <div class="grid-container" id="scheduleGrid"></div>
            </div>
            
            <!-- Spacer to prevent dock overlap -->
            <div style="height: 100px;"></div>
        </div>

        <!-- Today View -->
        <div id="todayView" class="view">
            <h2 style="padding: 16px 0; font-size: 24px;">H√¥m nay</h2>
            <div id="todayContainer" class="today-container"></div>
        </div>

        <!-- Subjects View -->
        <div id="subjectsView" class="view">
            <div style="padding: 16px 0; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="font-size: 24px;">M√¥n h·ªçc</h2>
                <button class="btn" onclick="showAddSubject()">+ Th√™m m√¥n</button>
            </div>
            <div id="subjectsList" class="subjects-list" style="padding-bottom: 120px;"></div>
        </div>

        <!-- Activities View -->
        <div id="activitiesView" class="view">
            <div style="padding: 16px 0; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="font-size: 24px;">Ho·∫°t ƒë·ªông kh√°c</h2>
                <button class="btn" onclick="showAddActivity()">+ Th√™m ho·∫°t ƒë·ªông</button>
            </div>
            <div id="activitiesList" class="activities-list" style="padding-bottom: 120px;"></div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="bottom-nav-item active" onclick="switchView('week')">
            <span class="bottom-nav-icon">üè´</span>
            <span>Tr√™n tr∆∞·ªùng</span>
        </button>
        <button class="bottom-nav-item" onclick="switchView('today')">
            <span class="bottom-nav-icon">üìç</span>
            <span>H√¥m nay</span>
        </button>
        <button class="bottom-nav-item" onclick="switchView('subjects')">
            <span class="bottom-nav-icon">üìö</span>
            <span>M√¥n h·ªçc</span>
        </button>
        <button class="bottom-nav-item" onclick="switchView('activities')">
            <span class="bottom-nav-icon">üéØ</span>
            <span>Ho·∫°t ƒë·ªông kh√°c</span>
        </button>
    </div>

    <!-- Add/Edit Subject Modal -->
    <div id="subjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="subjectModalTitle">Th√™m m√¥n h·ªçc</h3>
                <button class="btn-icon" onclick="closeSubjectModal()">‚úï</button>
            </div>
            <form id="subjectForm" onsubmit="saveSubject(event)">
                <div class="form-group">
                    <label class="form-label">T√™n m√¥n h·ªçc</label>
                    <input type="text" class="form-input" id="subjectName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Gi√°o vi√™n</label>
                    <input type="text" class="form-input" id="subjectTeacher">
                </div>
                <div class="form-group">
                    <label class="form-label">M√†u s·∫Øc</label>
                    <div class="color-picker" id="colorPicker"></div>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn" style="flex: 1;">L∆∞u</button>
                    <button type="button" class="btn" style="background: var(--text-secondary); flex: 1;" onclick="closeSubjectModal()">H·ªßy</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Schedule Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Th√™m ti·∫øt h·ªçc</h3>
                <button class="btn-icon" onclick="closeScheduleModal()">‚úï</button>
            </div>
            <form id="scheduleForm" onsubmit="saveSchedule(event)">
                <div class="form-group">
                    <label class="form-label">Th·ª©</label>
                    <select class="form-select" id="scheduleDay" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Bu·ªïi</label>
                    <select class="form-select" id="scheduleSession" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ti·∫øt</label>
                    <select class="form-select" id="schedulePeriod" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Th·ªùi gian b·∫Øt ƒë·∫ßu</label>
                    <input type="time" class="form-input" id="scheduleStartTime" required>
                </div>
                <div class="form-group">
                    <label class="form-label">M√¥n h·ªçc</label>
                    <select class="form-select" id="scheduleSubject" required></select>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn" style="flex: 1;">L∆∞u</button>
                    <button type="button" class="btn" style="background: var(--text-secondary); flex: 1;" onclick="closeScheduleModal()">H·ªßy</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Activity Modal -->
    <div id="activityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="activityModalTitle">Th√™m ho·∫°t ƒë·ªông</h3>
                <button class="btn-icon" onclick="closeActivityModal()">‚úï</button>
            </div>
            <form id="activityForm" onsubmit="saveActivity(event)">
                <div class="form-group">
                    <label class="form-label">T√™n ho·∫°t ƒë·ªông</label>
                    <input type="text" class="form-input" id="activityName" placeholder="VD: H·ªçc th√™m To√°n, ƒêi ch∆°i..." required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ng√†y</label>
                    <input type="date" class="form-input" id="activityDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Th·ªùi gian b·∫Øt ƒë·∫ßu</label>
                    <input type="time" class="form-input" id="activityTime" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ghi ch√∫ (tu·ª≥ ch·ªçn)</label>
                    <input type="text" class="form-input" id="activityNote" placeholder="ƒê·ªãa ƒëi·ªÉm, ng∆∞·ªùi li√™n h·ªá...">
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn" style="flex: 1;">L∆∞u</button>
                    <button type="button" class="btn" style="background: var(--text-secondary); flex: 1;" onclick="closeActivityModal()">H·ªßy</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const COLORS = [
            { name: 'Blue', color: '#4299e1', light: '#63b3ed' },
            { name: 'Green', color: '#48bb78', light: '#68d391' },
            { name: 'Purple', color: '#9f7aea', light: '#b794f4' },
            { name: 'Pink', color: '#ed64a6', light: '#f687b3' },
            { name: 'Orange', color: '#ed8936', light: '#f6ad55' },
            { name: 'Red', color: '#f56565', light: '#fc8181' },
            { name: 'Teal', color: '#38b2ac', light: '#4fd1c5' },
            { name: 'Indigo', color: '#667eea', light: '#7f9cf5' },
            { name: 'Yellow', color: '#ecc94b', light: '#f6e05e' },
            { name: 'Cyan', color: '#0bc5ea', light: '#76e4f7' }
        ];

        const DAYS = ['T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
        const PERIODS_MORNING = 5;
        const PERIODS_AFTERNOON = 5;
        const TOTAL_PERIODS = PERIODS_MORNING + PERIODS_AFTERNOON;
        
        // LocalStorage keys with prefix to avoid conflicts
        const STORAGE_PREFIX = 'tkb_app_';
        const STORAGE_KEYS = {
            SUBJECTS: STORAGE_PREFIX + 'subjects',
            SCHEDULE: STORAGE_PREFIX + 'schedule',
            THEME: STORAGE_PREFIX + 'theme',
            ACTIVITIES: STORAGE_PREFIX + 'activities'
        };

        let currentWeekOffset = 0;
        let subjects = JSON.parse(localStorage.getItem(STORAGE_KEYS.SUBJECTS)) || [];
        let schedule = JSON.parse(localStorage.getItem(STORAGE_KEYS.SCHEDULE)) || {};
        let currentTheme = localStorage.getItem(STORAGE_KEYS.THEME) || 'light';
        let editingSubjectId = null;
        let currentSession = 'morning'; // 'morning' or 'afternoon'
        let activities = JSON.parse(localStorage.getItem(STORAGE_KEYS.ACTIVITIES)) || [];
        let editingActivityId = null;

        // Initialize
        function init() {
            applyTheme();
            renderColorPicker();
            renderScheduleGrid();
            renderSubjectsList();
            updateWeekInfo();
            populateFormSelects();
            
            if (subjects.length === 0) {
                addDefaultSubjects();
            }
        }

        function addDefaultSubjects() {
            const defaults = [
                { name: 'To√°n', teacher: 'C√¥ H∆∞∆°ng', color: COLORS[0] },
                { name: 'VƒÉn', teacher: 'Th·∫ßy Nam', color: COLORS[1] },
                { name: 'Anh', teacher: 'C√¥ Linh', color: COLORS[2] },
                { name: 'L√Ω', teacher: 'Th·∫ßy D≈©ng', color: COLORS[3] },
                { name: 'H√≥a', teacher: 'C√¥ Mai', color: COLORS[4] },
                { name: 'Sinh', teacher: 'C√¥ Lan', color: COLORS[5] }
            ];
            
            defaults.forEach(s => {
                subjects.push({
                    id: Date.now() + Math.random(),
                    ...s
                });
            });
            
            saveSubjects();
            renderSubjectsList();
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem(STORAGE_KEYS.THEME, currentTheme);
            applyTheme();
        }

        function applyTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
        }

        function renderColorPicker() {
            const picker = document.getElementById('colorPicker');
            picker.innerHTML = COLORS.map((c, i) => 
                `<div class="color-option" style="background: ${c.color}" onclick="selectColor(${i})"></div>`
            ).join('');
        }

        let selectedColorIndex = 0;
        function selectColor(index) {
            selectedColorIndex = index;
            document.querySelectorAll('.color-option').forEach((el, i) => {
                el.classList.toggle('selected', i === index);
            });
        }

        function renderScheduleGrid() {
            const grid = document.getElementById('scheduleGrid');
            const today = new Date();
            const currentDay = today.getDay();
            
            let html = '<div class="grid-header"></div>';
            DAYS.forEach((day, i) => {
                const isToday = (i + 1) === currentDay;
                html += `<div class="grid-header ${isToday ? 'today' : ''}">${day}</div>`;
            });

            const periods = currentSession === 'morning' ? PERIODS_MORNING : PERIODS_AFTERNOON;
            const sessionLabel = currentSession === 'morning' ? 'S√°ng' : 'Chi·ªÅu';

            for (let period = 1; period <= periods; period++) {
                // Get time from first schedule item in this period, or use default
                let timeStr = '';
                let foundTime = false;
                
                for (let day = 0; day < 6; day++) {
                    const key = `${day}-${currentSession}-${period}`;
                    if (schedule[key] && schedule[key].startTime) {
                        timeStr = schedule[key].startTime;
                        foundTime = true;
                        break;
                    }
                }
                
                if (!foundTime) {
                    const startHour = currentSession === 'morning' ? 7 : 13;
                    const startTime = startHour * 60 + (period - 1) * 45;
                    timeStr = `${Math.floor(startTime / 60)}:${(startTime % 60).toString().padStart(2, '0')}`;
                }
                
                html += `<div class="grid-time">${sessionLabel} ${period}<span class="time-label">${timeStr}</span></div>`;
                
                for (let day = 0; day < 6; day++) {
                    const key = `${day}-${currentSession}-${period}`;
                    const scheduleItem = schedule[key];
                    
                    if (scheduleItem) {
                        const subject = subjects.find(s => s.id == scheduleItem.subjectId);
                        if (subject) {
                            html += `
                                <div class="grid-cell">
                                    <div class="subject-card" style="--subject-color: ${subject.color.color}; --subject-color-light: ${subject.color.light}" onclick="editScheduleItem('${key}')">
                                        <div class="subject-name">${subject.name}</div>
                                        <div class="subject-info">${subject.teacher || ''}</div>
                                    </div>
                                </div>
                            `;
                        } else {
                            html += `<div class="grid-cell" onclick="addScheduleItem(${day}, '${currentSession}', ${period})"></div>`;
                        }
                    } else {
                        html += `<div class="grid-cell" onclick="addScheduleItem(${day}, '${currentSession}', ${period})"></div>`;
                    }
                }
            }
            
            grid.innerHTML = html;
        }

        function renderTodayView() {
            const container = document.getElementById('todayContainer');
            const today = new Date();
            const dayIndex = today.getDay() - 1; // 0=T2, 1=T3, ..., 5=T7
            
            // If weekend, show message
            if (dayIndex < 0 || dayIndex > 5) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üéâ</div>
                        <p>H√¥m nay l√† cu·ªëi tu·∫ßn!</p>
                        <p style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">Ngh·ªâ ng∆°i th√¥i n√†o!</p>
                    </div>
                `;
                return;
            }
            
            let todayItems = [];
            
            // Get school schedule
            for (let period = 1; period <= PERIODS_MORNING; period++) {
                const key = `${dayIndex}-morning-${period}`;
                const item = schedule[key];
                if (item) {
                    const subject = subjects.find(s => s.id == item.subjectId);
                    if (subject) {
                        const [hours, minutes] = (item.startTime || '07:00').split(':');
                        const time = parseInt(hours) * 60 + parseInt(minutes);
                        todayItems.push({ 
                            type: 'class',
                            session: 'S√°ng', 
                            period, 
                            subject,
                            time,
                            timeStr: item.startTime || '07:00'
                        });
                    }
                }
            }
            
            for (let period = 1; period <= PERIODS_AFTERNOON; period++) {
                const key = `${dayIndex}-afternoon-${period}`;
                const item = schedule[key];
                if (item) {
                    const subject = subjects.find(s => s.id == item.subjectId);
                    if (subject) {
                        const [hours, minutes] = (item.startTime || '13:00').split(':');
                        const time = parseInt(hours) * 60 + parseInt(minutes);
                        todayItems.push({ 
                            type: 'class',
                            session: 'Chi·ªÅu', 
                            period, 
                            subject,
                            time,
                            timeStr: item.startTime || '13:00'
                        });
                    }
                }
            }

            // Get activities for today
            const todayStr = today.toISOString().split('T')[0];
            const todayActivities = activities.filter(a => a.date === todayStr);
            todayActivities.forEach(activity => {
                const [hours, minutes] = activity.time.split(':');
                const time = parseInt(hours) * 60 + parseInt(minutes);
                todayItems.push({
                    type: 'activity',
                    activity,
                    time,
                    timeStr: activity.time
                });
            });

            // Sort by time
            todayItems.sort((a, b) => a.time - b.time);

            if (todayItems.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìÖ</div>
                        <p>Kh√¥ng c√≥ g√¨ trong l·ªãch h√¥m nay</p>
                    </div>
                `;
                return;
            }

            const currentHour = today.getHours();
            const currentMinute = today.getMinutes();
            const currentTime = currentHour * 60 + currentMinute;

            let html = '';
            todayItems.forEach(item => {
                const isCurrent = currentTime >= item.time && currentTime < item.time + 45;
                const isUpcoming = currentTime < item.time;
                
                if (item.type === 'class') {
                    html += `
                        <div class="today-card ${isCurrent ? 'current' : ''}">
                            <div class="today-time">${item.session} - Ti·∫øt ${item.period} ‚Ä¢ ${item.timeStr}</div>
                            <div class="today-subject">${item.subject.name}</div>
                            <div class="today-details">
                                ${item.subject.teacher ? `<span>üë§ ${item.subject.teacher}</span>` : ''}
                            </div>
                            ${isCurrent ? '<span class="countdown">ƒêang h·ªçc</span>' : ''}
                            ${isUpcoming && currentTime > item.time - 15 ? '<span class="countdown">S·∫Øp t·ªõi</span>' : ''}
                        </div>
                    `;
                } else {
                    html += `
                        <div class="today-card" style="border-left: 4px solid #f59e0b;">
                            <div class="today-time">Ho·∫°t ƒë·ªông ‚Ä¢ ${item.timeStr}</div>
                            <div class="today-subject">${item.activity.name}</div>
                            <div class="today-details">
                                ${item.activity.note ? `<span>üìù ${item.activity.note}</span>` : ''}
                            </div>
                            <span class="activity-badge">Ho·∫°t ƒë·ªông kh√°c</span>
                        </div>
                    `;
                }
            });

            container.innerHTML = html;
        }

        function renderSubjectsList() {
            const list = document.getElementById('subjectsList');
            
            if (subjects.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìö</div>
                        <p>Ch∆∞a c√≥ m√¥n h·ªçc n√†o</p>
                        <button class="btn" onclick="showAddSubject()" style="margin-top: 16px;">Th√™m m√¥n ƒë·∫ßu ti√™n</button>
                    </div>
                `;
                return;
            }

            list.innerHTML = subjects.map(s => `
                <div class="subject-item">
                    <div class="subject-color-badge" style="background: ${s.color.color}"></div>
                    <div class="subject-item-info">
                        <div class="subject-item-name">${s.name}</div>
                        <div class="subject-item-details">
                            ${s.teacher ? `üë§ ${s.teacher}` : 'Ch∆∞a c√≥ gi√°o vi√™n'}
                        </div>
                    </div>
                    <button class="btn-icon" onclick="editSubject('${s.id}')">‚úèÔ∏è</button>
                    <button class="btn-icon" onclick="deleteSubject('${s.id}')">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function showAddSubject() {
            editingSubjectId = null;
            document.getElementById('subjectModalTitle').textContent = 'Th√™m m√¥n h·ªçc';
            document.getElementById('subjectForm').reset();
            selectColor(0);
            document.getElementById('subjectModal').classList.add('active');
        }

        function editSubject(id) {
            const subject = subjects.find(s => s.id == id);
            if (!subject) return;
            
            editingSubjectId = id;
            document.getElementById('subjectModalTitle').textContent = 'S·ª≠a m√¥n h·ªçc';
            document.getElementById('subjectName').value = subject.name;
            document.getElementById('subjectTeacher').value = subject.teacher || '';
            
            const colorIndex = COLORS.findIndex(c => c.color === subject.color.color);
            selectColor(colorIndex >= 0 ? colorIndex : 0);
            
            document.getElementById('subjectModal').classList.add('active');
        }

        function deleteSubject(id) {
            if (!confirm('X√≥a m√¥n h·ªçc n√†y? T·∫•t c·∫£ ti·∫øt h·ªçc li√™n quan c≈©ng s·∫Ω b·ªã x√≥a.')) return;
            
            subjects = subjects.filter(s => s.id != id);
            
            // Remove schedule items with this subject
            Object.keys(schedule).forEach(key => {
                if (schedule[key].subjectId == id) {
                    delete schedule[key];
                }
            });
            
            saveSubjects();
            saveSchedule();
            renderSubjectsList();
            renderScheduleGrid();
        }

        function saveSubject(e) {
            e.preventDefault();
            
            const name = document.getElementById('subjectName').value.trim();
            const teacher = document.getElementById('subjectTeacher').value.trim();
            const color = COLORS[selectedColorIndex];
            
            if (!name) {
                alert('Vui l√≤ng nh·∫≠p t√™n m√¥n h·ªçc!');
                return;
            }
            
            if (editingSubjectId) {
                const subject = subjects.find(s => s.id == editingSubjectId);
                if (subject) {
                    subject.name = name;
                    subject.teacher = teacher;
                    subject.color = color;
                }
            } else {
                subjects.push({
                    id: 'subj_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name,
                    teacher,
                    color
                });
            }
            
            saveSubjects();
            renderSubjectsList();
            renderScheduleGrid();
            populateFormSelects();
            closeSubjectModal();
        }

        function closeSubjectModal() {
            document.getElementById('subjectModal').classList.remove('active');
        }

        function addScheduleItem(day, session, period) {
            if (subjects.length === 0) {
                alert('Vui l√≤ng th√™m m√¥n h·ªçc tr∆∞·ªõc!');
                return;
            }
            
            populateFormSelects();
            document.getElementById('scheduleDay').value = day;
            document.getElementById('scheduleSession').value = session;
            document.getElementById('schedulePeriod').value = period;
            document.getElementById('scheduleSubject').value = '';
            
            // Set default start time based on session and period
            const startHour = session === 'morning' ? 7 : 13;
            const startTime = startHour * 60 + (period - 1) * 45;
            const timeStr = `${Math.floor(startTime / 60).toString().padStart(2, '0')}:${(startTime % 60).toString().padStart(2, '0')}`;
            document.getElementById('scheduleStartTime').value = timeStr;
            
            document.getElementById('scheduleModal').classList.add('active');
        }

        function editScheduleItem(key) {
            const parts = key.split('-');
            const day = parts[0];
            const session = parts[1];
            const period = parts[2];
            const item = schedule[key];
            
            if (!item) return;
            
            populateFormSelects();
            document.getElementById('scheduleDay').value = day;
            document.getElementById('scheduleSession').value = session;
            document.getElementById('schedulePeriod').value = period;
            document.getElementById('scheduleSubject').value = item.subjectId;
            document.getElementById('scheduleStartTime').value = item.startTime || '07:00';
            document.getElementById('scheduleModal').classList.add('active');
        }

        function saveSchedule(e) {
            e.preventDefault();
            
            const day = document.getElementById('scheduleDay').value;
            const session = document.getElementById('scheduleSession').value;
            const period = document.getElementById('schedulePeriod').value;
            const subjectId = document.getElementById('scheduleSubject').value;
            const startTime = document.getElementById('scheduleStartTime').value;
            
            console.log('Saving schedule:', { day, session, period, subjectId, startTime });
            
            if (!subjectId) {
                alert('Vui l√≤ng ch·ªçn m√¥n h·ªçc!');
                return;
            }
            
            const key = `${day}-${session}-${period}`;
            
            if (subjectId === 'remove') {
                delete schedule[key];
                console.log('Removed schedule at', key);
            } else {
                schedule[key] = { subjectId: subjectId, startTime: startTime };
                console.log('Added schedule at', key, ':', schedule[key]);
            }
            
            console.log('Full schedule object:', schedule);
            
            saveScheduleData();
            
            // Verify it was saved
            const saved = localStorage.getItem(STORAGE_KEYS.SCHEDULE);
            console.log('Saved to localStorage:', saved);
            
            renderScheduleGrid();
            renderTodayView();
            closeScheduleModal();
        }

        function closeScheduleModal() {
            document.getElementById('scheduleModal').classList.remove('active');
        }

        function populateFormSelects() {
            // Day select
            const daySelect = document.getElementById('scheduleDay');
            daySelect.innerHTML = DAYS.map((day, i) => 
                `<option value="${i}">${day}</option>`
            ).join('');
            
            // Session select
            const sessionSelect = document.getElementById('scheduleSession');
            sessionSelect.innerHTML = `
                <option value="morning">Bu·ªïi s√°ng</option>
                <option value="afternoon">Bu·ªïi chi·ªÅu</option>
            `;
            
            // Period select
            const periodSelect = document.getElementById('schedulePeriod');
            periodSelect.innerHTML = Array.from({length: 5}, (_, i) => 
                `<option value="${i + 1}">Ti·∫øt ${i + 1}</option>`
            ).join('');
            
            // Subject select
            const subjectSelect = document.getElementById('scheduleSubject');
            subjectSelect.innerHTML = `
                <option value="">-- Ch·ªçn m√¥n --</option>
                ${subjects.map(s => `<option value="${s.id}">${s.name}</option>`).join('')}
                <option value="remove">üóëÔ∏è X√≥a ti·∫øt h·ªçc</option>
            `;
        }

        function showSession(session) {
            currentSession = session;
            
            // Update button styles
            const btnMorning = document.getElementById('btnMorning');
            const btnAfternoon = document.getElementById('btnAfternoon');
            
            if (session === 'morning') {
                btnMorning.style.background = 'var(--accent)';
                btnAfternoon.style.background = 'var(--text-secondary)';
            } else {
                btnMorning.style.background = 'var(--text-secondary)';
                btnAfternoon.style.background = 'var(--accent)';
            }
            
            renderScheduleGrid();
        }

        function showAddScheduleQuick() {
            if (subjects.length === 0) {
                alert('Vui l√≤ng th√™m m√¥n h·ªçc tr∆∞·ªõc!');
                switchView('subjects');
                return;
            }
            
            populateFormSelects();
            document.getElementById('scheduleSession').value = currentSession;
            document.getElementById('scheduleModal').classList.add('active');
        }

        function switchView(view) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.bottom-nav-item').forEach(item => item.classList.remove('active'));
            
            if (view === 'week') {
                document.getElementById('weekView').classList.add('active');
                document.querySelectorAll('.bottom-nav-item')[0].classList.add('active');
            } else if (view === 'today') {
                document.getElementById('todayView').classList.add('active');
                document.querySelectorAll('.bottom-nav-item')[1].classList.add('active');
                renderTodayView();
            } else if (view === 'subjects') {
                document.getElementById('subjectsView').classList.add('active');
                document.querySelectorAll('.bottom-nav-item')[2].classList.add('active');
            } else if (view === 'activities') {
                document.getElementById('activitiesView').classList.add('active');
                document.querySelectorAll('.bottom-nav-item')[3].classList.add('active');
                renderActivitiesList();
            }
        }

        function previousWeek() {
            currentWeekOffset--;
            updateWeekInfo();
            renderScheduleGrid();
        }

        function nextWeek() {
            currentWeekOffset++;
            updateWeekInfo();
            renderScheduleGrid();
        }

        function goToToday() {
            currentWeekOffset = 0;
            updateWeekInfo();
            renderScheduleGrid();
        }

        function updateWeekInfo() {
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay() + 1 + (currentWeekOffset * 7));
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            
            const title = currentWeekOffset === 0 ? 'Tu·∫ßn n√†y' : 
                         currentWeekOffset > 0 ? `Tu·∫ßn sau (+${currentWeekOffset})` : 
                         `Tu·∫ßn tr∆∞·ªõc (${currentWeekOffset})`;
            
            const dateStr = `${weekStart.getDate()}/${weekStart.getMonth() + 1} - ${weekEnd.getDate()}/${weekEnd.getMonth() + 1}`;
            
            document.getElementById('weekTitle').textContent = title;
            document.getElementById('weekDate').textContent = dateStr;
        }

        function showSettings() {
            const options = [
                '1. üíæ Sao l∆∞u d·ªØ li·ªáu',
                '2. üì• Kh√¥i ph·ª•c d·ªØ li·ªáu',
                '3. üóëÔ∏è X√≥a t·∫•t c·∫£ d·ªØ li·ªáu',
                '4. ‚ùå H·ªßy'
            ];
            
            const choice = prompt(options.join('\n') + '\n\nNh·∫≠p s·ªë (1-4):');
            
            if (choice === '1') {
                // Export data
                const data = {
                    subjects: subjects,
                    schedule: schedule,
                    activities: activities,
                    exportDate: new Date().toISOString()
                };
                const json = JSON.stringify(data, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tkb-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                alert('‚úÖ ƒê√£ t·∫£i file sao l∆∞u!');
            } else if (choice === '2') {
                // Import data
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            if (data.subjects && data.schedule) {
                                subjects = data.subjects;
                                schedule = data.schedule;
                                activities = data.activities || [];
                                saveSubjects();
                                saveScheduleData();
                                saveActivities();
                                renderSubjectsList();
                                renderScheduleGrid();
                                renderTodayView();
                                renderActivitiesList();
                                alert('‚úÖ Kh√¥i ph·ª•c d·ªØ li·ªáu th√†nh c√¥ng!');
                            } else {
                                alert('‚ùå File kh√¥ng h·ª£p l·ªá!');
                            }
                        } catch (err) {
                            alert('‚ùå L·ªói: ' + err.message);
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            } else if (choice === '3') {
                if (confirm('‚ö†Ô∏è X√≥a t·∫•t c·∫£ m√¥n h·ªçc, l·ªãch h·ªçc v√† ho·∫°t ƒë·ªông?\n\nH√†nh ƒë·ªông n√†y KH√îNG TH·ªÇ ho√†n t√°c!')) {
                    subjects = [];
                    schedule = {};
                    activities = [];
                    localStorage.removeItem(STORAGE_KEYS.SUBJECTS);
                    localStorage.removeItem(STORAGE_KEYS.SCHEDULE);
                    localStorage.removeItem(STORAGE_KEYS.ACTIVITIES);
                    renderSubjectsList();
                    renderScheduleGrid();
                    renderTodayView();
                    renderActivitiesList();
                    alert('‚úÖ ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu!');
                }
            }
        }

        function saveSubjects() {
            localStorage.setItem(STORAGE_KEYS.SUBJECTS, JSON.stringify(subjects));
        }

        function saveScheduleData() {
            localStorage.setItem(STORAGE_KEYS.SCHEDULE, JSON.stringify(schedule));
        }

        function saveActivities() {
            localStorage.setItem(STORAGE_KEYS.ACTIVITIES, JSON.stringify(activities));
        }

        // Activities functions
        function renderActivitiesList() {
            const list = document.getElementById('activitiesList');
            
            if (activities.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üéØ</div>
                        <p>Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</p>
                        <button class="btn" onclick="showAddActivity()" style="margin-top: 16px;">Th√™m ho·∫°t ƒë·ªông ƒë·∫ßu ti√™n</button>
                    </div>
                `;
                return;
            }

            // Sort by date and time
            const sorted = [...activities].sort((a, b) => {
                if (a.date !== b.date) return a.date.localeCompare(b.date);
                return a.time.localeCompare(b.time);
            });

            list.innerHTML = sorted.map(a => {
                const date = new Date(a.date);
                const dateStr = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
                
                return `
                    <div class="activity-item">
                        <div class="activity-header">
                            <div class="activity-name">${a.name}</div>
                            <div class="activity-time">${a.time}</div>
                        </div>
                        <div class="activity-details">
                            <span>üìÖ ${dateStr}</span>
                            ${a.note ? `<span>üìù ${a.note}</span>` : ''}
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 12px;">
                            <button class="btn-icon" onclick="editActivity('${a.id}')">‚úèÔ∏è</button>
                            <button class="btn-icon" onclick="deleteActivity('${a.id}')">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showAddActivity() {
            editingActivityId = null;
            document.getElementById('activityModalTitle').textContent = 'Th√™m ho·∫°t ƒë·ªông';
            document.getElementById('activityForm').reset();
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('activityDate').value = today;
            
            document.getElementById('activityModal').classList.add('active');
        }

        function editActivity(id) {
            const activity = activities.find(a => a.id == id);
            if (!activity) return;
            
            editingActivityId = id;
            document.getElementById('activityModalTitle').textContent = 'S·ª≠a ho·∫°t ƒë·ªông';
            document.getElementById('activityName').value = activity.name;
            document.getElementById('activityDate').value = activity.date;
            document.getElementById('activityTime').value = activity.time;
            document.getElementById('activityNote').value = activity.note || '';
            
            document.getElementById('activityModal').classList.add('active');
        }

        function deleteActivity(id) {
            if (!confirm('X√≥a ho·∫°t ƒë·ªông n√†y?')) return;
            
            activities = activities.filter(a => a.id != id);
            saveActivities();
            renderActivitiesList();
            renderTodayView();
        }

        function saveActivity(e) {
            e.preventDefault();
            
            const name = document.getElementById('activityName').value.trim();
            const date = document.getElementById('activityDate').value;
            const time = document.getElementById('activityTime').value;
            const note = document.getElementById('activityNote').value.trim();
            
            if (!name || !date || !time) {
                alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }
            
            if (editingActivityId) {
                const activity = activities.find(a => a.id == editingActivityId);
                if (activity) {
                    activity.name = name;
                    activity.date = date;
                    activity.time = time;
                    activity.note = note;
                }
            } else {
                activities.push({
                    id: 'act_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name,
                    date,
                    time,
                    note
                });
            }
            
            saveActivities();
            renderActivitiesList();
            renderTodayView();
            closeActivityModal();
        }

        function closeActivityModal() {
            document.getElementById('activityModal').classList.remove('active');
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
